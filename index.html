<script>
  // ======= CIFRA (A-Z) =======
  const mapa = {
    a:"r", b:"k", c:"z", d:"q", e:"t", f:"y",
    g:"h", h:"f", i:"p", j:"l", k:"j", l:"v",
    m:"s", n:"d", o:"x", p:"g", q:"b", r:"n",
    s:"o", t:"m", u:"c", v:"i", w:"u", x:"e",
    y:"w", z:"a"
  };
  const inv = Object.fromEntries(Object.entries(mapa).map(([k,v]) => [v,k]));

  let direction = "H2I"; // H2I ou I2H

  const inputEl  = document.getElementById("input");
  const outputEl = document.getElementById("output");
  const modeLabel = document.getElementById("modeLabel");
  const toggleMode = document.getElementById("toggleMode");
  const copyOut = document.getElementById("copyOut");
  const countInfo = document.getElementById("countInfo");

  function translate(text){
    const src = (text ?? "").toLowerCase();
    const table = (direction === "H2I") ? mapa : inv;

    let out = "";
    for (let i=0; i<src.length; i++){
      const ch = src[i];
      out += (table[ch] ?? ch);
    }
    return out;
  }

  function render(){
    if(!inputEl || !outputEl) return;
    const t = inputEl.value || "";
    outputEl.textContent = translate(t);
    if(countInfo) countInfo.textContent = `${t.length} chars`;
  }

  function setMode(){
    direction = (direction === "H2I") ? "I2H" : "H2I";
    if(modeLabel){
      modeLabel.textContent = (direction === "H2I") ? "Humano → Infernal" : "Infernal → Humano";
    }
    render();
  }

  // Tradução em tempo real (várias fontes de evento pra não falhar)
  ["input","keyup","paste","cut","change"].forEach(evt=>{
    inputEl?.addEventListener(evt, render);
  });

  toggleMode?.addEventListener("click", setMode);

  copyOut?.addEventListener("click", async () => {
    try{
      await navigator.clipboard.writeText(outputEl?.textContent || "");
      copyOut.textContent = "Copiado!";
      setTimeout(()=> copyOut.textContent = "Copiar saída", 900);
    } catch(e){
      copyOut.textContent = "Falhou :(";
      setTimeout(()=> copyOut.textContent = "Copiar saída", 900);
    }
  });

  // Atalho TAB alterna modo
  window.addEventListener("keydown", (e) => {
    if(e.key === "Tab"){
      e.preventDefault();
      setMode();
    }
  });

  // Primeira renderização
  render();
</script>
